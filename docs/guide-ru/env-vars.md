# Переменые окружения

Система состоит из разных модулей, которые гибко настраиваются [переменными окружени](https://wiki.archlinux.org/index.php/Environment_variables_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9))
Каждый модуль может работать отдельно от остальных.

## Глобальные
| Название переменной | Тип    | Значение по умолчанию | Описание                                                        |
|:--------------------|:-------|:----------------------|:----------------------------------------------------------------|
| APP_DEBUG           | bool   | false                 |                                                                 |
| APP_ENV             | string |                       | Название окружения в котором запускается система.               |
| APP_SENTRY_DSN      | string | нету                  | Токен от системы мониторинга ошибок [Sentry](https://sentry.io) |
| REDIS_HOST          | string | redis                 | Имя хоста для подлючения к redis                                |
| REDIS_PORT          | number | 6379                  | порт подключения к redis                                        |
| REDIS_DB            | number | 2                     | номер базы данных                                               |
| REDIS_PREFIX        | string | cache_                | Перфикс в имени ключей                                          |


## Запуск процесса ноды

| Название переменной             | Тип    | Значение по умолчанию  | Описание                                                                                |
|:--------------------------------|:-------|:-----------------------|:----------------------------------------------------------------------------------------|
| APP_BLOCKCHAIN_RUN_NODE         | bool   | true                   | Флаг для запуска подпроцесса ноды                                                       |
| APP_BLOCKCHAIN_VERSION          | string | current                | Версия блокчейна и часть имени бинарного файла которы будет запущен                     |
| APP_BLOCKCHAIN_HOME             | string | {cwd}/blockchain/      | путь к домашней директории ноды                                                         |
| APP_BLOCKCHAIN_BIN_DIR          | string | {cwd}/bin/             | Путь к папке с запускаемыми файлами                                                     |
| APP_BLOCKCHAIN_CONFIG_DIR       | string | {cwd}/config/          | Путь к папке с настройками                                                              |
| APP_BLOCKCHAIN_LOGS_TO_STDOUT   | bool   | true                   | Транслировать ли логи запущенной ноды в ситсему логирования                             |
| APP_BLOCKCHAIN_NOTIFY_NEW_BLOCK | bool   | true                   | Гнерировать ли ивент о том что пришёл новый блок если в логах были обнаружены данные    |
 
 
| Название переменной           | Тип                       | Значение по умолчанию | Описание                                               |
|:------------------------------|:--------------------------|:----------------------|:-------------------------------------------------------|
| APP_NODE_NETWORK=testNet      | enum(testNet или mainNet) | testNet               | Тип сети. Участвует в подписании транзакции            |
| APP_NODE_API_TYPE=node        | enum(node или gate)       | gate                  | Тип подключения к ноде. Гейт или апи ноды              |
| APP_NODE_BASE_URL             | string                    | http://localhost:8841 | Базоый URL для запроса к ноде                          |
| APP_NODE_PUBLIC_KEY_VALIDATOR | string                    | пустая строка         | Публичный ключь для подписи транзакций setCandidateOff |
| APP_NODE_PRIVATE_KEY          | string                    | пустая строка         | Приватный ключь для подписи транзакций setCandidateOff |
| APP_NODE_API_DEBUG_PROXY      | boolean                   | false                 | Включение проксирования запросов к api                 |
| APP_NODE_API_DEBUG_PROXY_HOST | string                    | 127.0.0.1             | Хост прокси сервера                                    |
| APP_NODE_API_DEBUG_PROXY_PORT | number                    | 9000                  | Порт прокси сервера                                    |
            
## Api сервера
#### Модуль предназначен для получение данных и статистики о инстансе черех http запрос
                
| Название переменной            | Тип    | Значение по умолчанию | Описание                                 |
|:-------------------------------|:-------|:----------------------|:-----------------------------------------|
| APP_API_SERVER_HOST            | string | *                     | С каких интерфейсов принимать запросы    |
| APP_API_SERVER_PORT            | number | 3000                  | Порт на котором будет висеть http сервер |
| APP_API_SERVER_REQUEST_TIMEOUT | number | default               | Временной лимит на запрос                |

## Модуль мониторинга
| Название переменной                               | Тип                        | Значение по умолчанию | Описание                                                                            |
|:--------------------------------------------------|:---------------------------|:----------------------|:------------------------------------------------------------------------------------|
| APP_MONITORING_ROLE                               | enum(validator или sentry) | sentry                | В данный момент не используется по коду. TODO                                       |
| APP_MONITORING_SPLASH_CHECKER_ENABLED             | bool                       | true                  | Включает модуль проверки пропуска блоков и отключения ноды                          |
| APP_MONITORING_SPLASH_CHECKER_ADDRESS             | string                     | пустая строка         | Адрес, за которым будет следить модуль                                              |
| APP_MONITORING_SPLASH_CHECKER_SKIPPED_BLOCK_LIMIT | number                     | 10                    | Количество пропущенных блоков, после когорого будет сгенерирован ивент о выключении |
| APP_MONITORING_BLOCK_NOTIFY_ENABLED               | bool                       | default               | Включает модуль проверки нет ли новых блоков по API                                 |
| APP_MONITORING_BLOCK_NOTIFY_REQUEST_INTERVAL      | number(ms)                 | 1000(ms)              | Как часто  спрашивать API о новом блоке                                             |

## Модуль уведомлений 
| Название переменной         | Тип    | Значение по умолчанию | Описание                                                                                                                                  |
|:----------------------------|:-------|:----------------------|:------------------------------------------------------------------------------------------------------------------------------------------|
| APP_NOTIFY_ENABLED          | bool   | false                 | Влкючение модуля нотификации                                                                                                              |
| APP_NOTIFY_TELEGRAM_ENABLED | bool   | false                 | Включение модуля нотификации в телеграм                                                                                                   |
| APP_NOTIFY_TELEGRAM_CHAT_ID | string | пустая строка         | ID чата в который слать уведомления( [инструкция](https://stackoverflow.com/questions/32423837/telegram-bot-how-to-get-a-group-chat-id) ) |
| APP_NOTIFY_TELEGRAM_TOKEN   | string | пустая строка         | Токен телеграм бота ([инструкция](https://core.telegram.org/bots))                                                                        |
